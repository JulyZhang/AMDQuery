<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
  <title></title>
  <link href="/styles/reset.css" rel="stylesheet" type="text/css" />
  <script src="../../amdquery/amdquery.js" type="text/javascript" amdquery="define:$;package:main;" amd="detectCR:1;" module="compatibleEvent:1;testLogByHTML:1"></script>
  <script type="text/javascript">
    $.require([
      "base/typed",
      "main/query",
      "main/event",
      "main/data",
      "module/Test"
    ], function(typed, query, event, data, Test) {
      var testEvent = new Test("TestEvent");
      var diva = query.getEleById("a");
      var divb = query.getEleById("b");
      var testContext = null;
      var testResult = null;
      var fn = function(ret){
        testContext = this;
        testResult = ret;
      }
      var fn1 = function(){};

      var fn2 = function(){
        var a = 1;
      };

      testEvent
      .execute("diva on fn by event, name is 'foo bar back click'.", function(preResult){
        event.on(diva, "foo bar back click", fn);
      })
      .equal("diva has handler foo.", true, function(preResult){
        return event.hasHandler(diva, "foo", fn) > -1;
      })
      .equal("diva has handler bar.", true, function(preResult){
        return event.hasHandler(diva, "bar", fn) > -1;
      })
      .equal("diva has handler back.", true, function(preResult){
        return event.hasHandler(diva, "back", fn) > -1;
      })
      .equal("diva has handler click.", true, function(preResult){
        return event.hasHandler(diva, "click", fn) > -1;
      })
      .equal("diva clone to div b, diva handlers equal div b.", true, function(preResult){
        event.cloneHandlers(b, a);
        return $.util.isEqual(event.getHandlers(a), event.getHandlers(b));
      })
      .equal("diva trigger foo, the fn result and context equal.", true, function(preResult){
        event.trigger(diva, "foo", diva, "result");
        return testResult == "result" && testContext === diva;
      })
      .equal("diva trigger click, the fn event type is 'click', event.screenX is 5.", true, function(preResult){
        event.trigger(diva, "click", diva, {screenX:5});
        return testResult && testResult.type == "click" && testResult.screenX == 5;
      })
      .equal("div b trigger bar, the fn result and context equal.", true, function(preResult){
        event.trigger(divb, "bar", divb, "result");
        return testResult == "result" && testContext === divb;
      })
      .equal("div b trigger click, the fn event type is 'click', event.screenX is 10.", true, function(preResult){
        event.trigger(divb, "click", divb, {screenX:10});
        return testResult && testResult.type == "click" && testResult.screenX == 10;
      })
      .execute("div b clear handlers", function(preResult){
        event.clearHandlers(divb);
      })
      .execute("diva off 'bar click'.", function(preResult){
        event.off(diva, "bar click", fn);
      })
      .equal("diva has handler bar return -1.", -1, function(preResult){
        return event.hasHandler(diva, "bar", fn);
      })
      .equal("diva has handler click return -1.", -1, function(preResult){
        return event.hasHandler(diva, "click", fn);
      })
      .equal("function fn.__proxy is undefined", undefined, function(preResult){
        return fn.__proxy;
      })
      .equal("diva trigger click, the fn event type is null because set it null and does not trigger click", null, function(preResult){
        var testResult = null;
        event.trigger(diva, "click", diva, {screenX:10});
        return testResult;
      })
      .execute("diva on fn1 by 'back'.", function(preResult){
        event.on(diva, "back", fn1);
      })
      .equal("diva length of handlers 'back' is 2 .", 2, function(preResult){
        return event.getHandlers(diva, "back").length;
      })
      .execute("diva clear handlers 'back'.", function(preResult){
        event.clear(diva, "back");
      })
      .equal("diva length of handlers 'back' is null .", null, function(preResult){
        return event.getHandlers(diva, "back");
      })
      .execute("diva clear handlers.", function(preResult){
        event.clear(diva);
      })
      .equal("diva handlers is empty object.", true, function(preResult){
        return typed.isEmptyObj(event.getHandlers(diva));
      })
      .execute("diva once fn2 'click once'", function(preResult){
        event.once(diva, "click once", fn2);
      })
      .equal("diva has handler 'click' and 'once'.", true, function(preResult){
        return event.hasHandler(diva, "click", fn2) > -1 && event.hasHandler(diva, "once", fn2) > -1;
      })
      .execute("diva trigger 'once'", function(preResult){
        event.trigger(diva, "once", diva);
      })
      .execute("diva trigger 'click'", function(preResult){
        event.trigger(diva, "click", diva, {screenX:10});
      })
      .equal("diva has handler once, result is -1.", -1, function(preResult){
        return event.hasHandler(diva, "once", fn2);
      })
      .equal("diva has handler click, result is -1.", -1, function(preResult){
        return event.hasHandler(diva, "click", fn2);
      })
      .equal("diva has data return false", false, function(preResult){
        return data.hasData(diva);
      })
      .execute("diva test toggle", function(preResult){
        event.toggle(diva, function(){
          diva.style.backgroundColor = "yellow"
        }, function(){
          diva.style.backgroundColor = "red"
        });
      })
      .equal("diva backgroundColor is 'yellow' when trigger click", "yellow", function(){
        event.trigger(diva, "click");
        return diva.style.backgroundColor;
      })
      .equal("diva backgroundColor is 'red' when trigger click", "red", function(){
        event.trigger(diva, "click");
        return diva.style.backgroundColor;
      })
      .equal("diva backgroundColor is 'yellow' when trigger click", "yellow", function(){
        event.trigger(diva, "click");
        return diva.style.backgroundColor;
      })
      .equal("diva remove toggle then diva has data return false", false, function(){
        event.toggle(diva);
        return data.hasData(diva);
      })
      .start();

    });
  </script>
</head>

<body style="overflow: auto">
  <div id="a" style="width: 100px; height: 100px; background-color: red;">
  </div>
  <div id="b" style="width: 100px; height: 100px; background-color: green;">
  </div>
</body>

</html>
